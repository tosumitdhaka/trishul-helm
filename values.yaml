# ============================================
# Trishul Helm Chart - Default Values
# ============================================

# ============================================
# Global Configuration
# ============================================
global:
  imageRegistry: []

# ============================================
# Image Configuration
# ============================================
image:
  backend:
    registry: "ghcr.io/tosumitdhaka"  # Override global registry if needed
    repository: trishul-backend
    tag: "2.1.8"
    pullPolicy: IfNotPresent
    pullSecret: "ghcr-secret"
  frontend:
    registry: "ghcr.io/tosumitdhaka"  # Override global registry if needed
    repository: trishul-frontend
    tag: "2.1.8"
    pullPolicy: IfNotPresent
    pullSecret: "ghcr-secret"
  mysql:
    registry: ""  # Override global registry if needed
    repository: mysql
    tag: "8.0"
    pullPolicy: IfNotPresent

imagePullSecrets: []

# ============================================
# Service Configuration
# ============================================
service:
  frontend:
    type: NodePort
    port: 80
    nodePort: 30080
    annotations: {}
  
  backend:
    type: ClusterIP  # Internal only, accessed via frontend proxy
    port: 8000
    # SNMP trap receiver
    trapPort: 1162
    trapNodePort: 30162  # External port for trap receiver
    annotations: {}
  
  mysql:
    type: ClusterIP
    port: 3306
    annotations: {}

# ============================================
# MySQL Configuration
# ============================================
mysql:
  rootPassword: "trishul123"
  
  # Character set
  characterSet: utf8mb4
  collation: utf8mb4_unicode_ci

# ============================================
# Persistence Configuration
# ============================================
persistence:
  mysql:
    enabled: true
    storageClass: "standard"
    accessMode: ReadWriteOnce
    size: 5Gi
    annotations: {}
  
  backend:
    enabled: true
    storageClass: "standard"
    accessMode: ReadWriteOnce
    size: 2Gi
    annotations: {}

# ============================================
# Replica Configuration
# ============================================
replicas:
  backend: 1
  frontend: 1

# ============================================
# Resource Limits
# ============================================
resources:
  backend:
    requests:
      memory: "1024Mi"
      cpu: "1000m"
    limits:
      memory: "3Gi"
      cpu: "1500m"
  
  frontend:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"
  
  mysql:
    requests:
      memory: "512Mi"
      cpu: "150m"
    limits:
      memory: "1536Mi"
      cpu: "300m"

# ============================================
# Advanced Options
# ============================================
# Enable hostNetwork for port 162 trap receiver (requires privileges)
hostNetwork: false

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# ============================================
# Application Configuration
# Only specify values you want to override
# All other config.yaml parameters will use defaults
# ============================================
config:
  project:
    name: Trishul
    version: "2.1.8"
  
  database:
    batch_size: 2000
  
  parser:
    mib_search_dirs:
      - /usr/share/snmp/mibs
      - /app/standard_mibs

  cache: {}
  
  jobs:
    concurrency: 2
  
  cleanup: {}

  export:
    chunk_size: 10000
  
  upload:
    max_size_mb: 500

  logging:
    level: INFO
  
  traps:
    sync_strategy: append
    skip_synced: true
    batch_size: 1000

  web:
    host: 0.0.0.0
    port: 8000
    cors_origins:
      - '*'
  
  ui:
    data_table:
      priority_columns:
        - notification_name
        - notification_oid
        - object_name
        - object_oid
        - node_type
        - module_name
        - object_status
        - object_description

  # External Links (CNF deployment only)
  # Remove or comment out for standalone deployments
  external_links:
    prometheus:
      enabled: true
      url: "http://localhost:30090"  # Your Prometheus NodePort URL
      label: "Prometheus"
      description: "View metrics and create custom queries"
      icon: '<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/><circle cx="12" cy="12" r="10"/>'
      color: "warning"
    
    grafana:
      enabled: true
      url: "http://localhost:30092"  # Your Grafana NodePort URL
      label: "Grafana"
      description: "Visualize metrics with dashboards"
      icon: '<path d="M3 3v18h18"/><path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>'
      color: "info"
    
    alertmanager:
      enabled: true
      url: "http://localhost:30091"  # Your Alertmanager NodePort URL
      label: "Alertmanager"
      description: "Manage alerts and notifications"
      icon: '<path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>'
      color: "danger"

# ============================================
# Monitoring Configuration (Optional)
# ============================================
monitoring:
  enabled: true  # Set to true to enable Prometheus monitoring
  
  prometheus:
    retention: "7d"
    scrapeInterval: "30s"
    evaluation_interval: "30s"
    
    storage:
      enabled: true
      size: 2Gi
      storageClass: "standard"
    
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 250m
        memory: 512Mi
    
    service:
      type: NodePort
      nodePort: 30090

    # Metric relabeling - drop unwanted metrics
    metricRelabelConfigs:
      # Drop high-cardinality node metrics
      - source_labels: [__name__]
        regex: 'node_(network_transmit_packets_total|network_receive_packets_total|disk_read_bytes_total|disk_written_bytes_total|filesystem_files.*|netstat_.*|sockstat_.*|timex_.*|nf_.*|arp_.*)'
        action: drop
      # Drop detailed kube metrics
      - source_labels: [__name__]
        regex: 'kube_(pod_container_status_.*_reason|pod_init_container_.*|endpoint_.*|service_spec_.*|configmap_.*|secret_.*)'
        action: drop
  
  # Node exporter - collects node-level metrics
  nodeExporter:
    enabled: true
    resources:
      requests:
        cpu: 50m
        memory: 32Mi
      limits:
        cpu: 100m
        memory: 64Mi
  
  # Kube-state-metrics - collects K8s resource metrics
  kubeStateMetrics:
    enabled: true
    resources:
      requests:
        cpu: 50m
        memory: 32Mi
      limits:
        cpu: 100m
        memory: 64Mi

  # Alertmanager configuration
  alertmanager:
    enabled: true

    retention: "120h"  # 5 days
    
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 100m
        memory: 128Mi
    
    service:
      type: NodePort
      nodePort: 30091

    config:
      global:
        resolve_timeout: 5m
      
      route:
        group_by: ['alertname', 'severity']
        group_wait: 10s
        group_interval: 10s
        repeat_interval: 12h
        receiver: 'default'
        
        routes:
        # Critical alerts - immediate notification
        - match:
            severity: critical
          receiver: 'critical'
          repeat_interval: 5m
        
        # Warning alerts - notify once per hour
        - match:
            severity: warning
          receiver: 'warning'
          repeat_interval: 1h
        
        # Info alerts - daily digest
        - match:
            severity: info
          receiver: 'info'
          repeat_interval: 24h
      
      receivers:
      - name: 'default'
      
      - name: 'critical'
        # Add your critical notification channel
        # slack_configs:
        # - api_url: 'https://hooks.slack.com/services/XXX'
        #   channel: '#alerts-critical'
      
      - name: 'warning'
        # Add your warning notification channel
      
      - name: 'info'
        # Add your info notification channel

  # Grafana configuration
  grafana:
    enabled: true
    
    # Admin credentials
    adminUser: admin
    adminPassword: admin123  # Change in production!
    
    storage:
      enabled: true
      size: 2Gi
      storageClass: "standard"
    
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi
    
    service:
      type: NodePort
      nodePort: 30092  # Access Grafana at http://node-ip:30300
